<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Змейка · Mobile</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0f172a, #020617);
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 460px;
      padding: 16px;
    }

    .card {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 22px;
      padding: 16px 16px 18px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.6);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
    }

    .title {
      font-weight: 600;
      letter-spacing: 0.02em;
      font-size: 14px;
      text-transform: uppercase;
      color: #cbd5f5;
    }

    .score-box {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
    }

    .score-pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 118, 110, 0.2);
      border: 1px solid rgba(45, 212, 191, 0.4);
      color: #a5f3fc;
    }

    .best-pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(30, 64, 175, 0.4);
      border: 1px solid rgba(129, 140, 248, 0.7);
      color: #bfdbfe;
    }

    .canvas-wrap {
      margin-top: 2px;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: radial-gradient(circle at top, #020617, #020617);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    canvas {
      display: block;
      touch-action: none;
    }

    .controls {
      margin-top: 10px;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      grid-template-rows: repeat(2, auto);
      gap: 8px;
      justify-items: center;
      align-items: center;
      user-select: none;
      -webkit-user-select: none;
    }

    .btn-dir {
      width: 62px;
      height: 62px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: radial-gradient(circle at top, #111827, #020617);
      color: #e5e7eb;
      font-size: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.55);
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.08s ease, border-color 0.08s ease;
    }

    .btn-dir:active {
      transform: translateY(1px) scale(0.97);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.6);
      border-color: rgba(45, 212, 191, 0.9);
    }

    .btn-up {
      grid-column: 2 / span 1;
      grid-row: 1;
    }

    .btn-left {
      grid-column: 1;
      grid-row: 2;
    }

    .btn-down {
      grid-column: 2;
      grid-row: 2;
    }

    .btn-right {
      grid-column: 3;
      grid-row: 2;
    }

    .hint {
      margin-top: 6px;
      font-size: 11px;
      text-align: center;
      color: #9ca3af;
      opacity: 0.9;
    }

    .badge-status {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.8);
      color: #e5e7eb;
    }

    .badge-status.paused {
      border-color: rgba(249, 115, 22, 0.9);
      color: #fed7aa;
    }

    .badge-status.over {
      border-color: rgba(239, 68, 68, 0.95);
      color: #fecaca;
    }

    @media (max-width: 380px) {
      .btn-dir {
        width: 54px;
        height: 54px;
        font-size: 18px;
      }

      .card {
        padding: 14px;
        border-radius: 18px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <div class="header">
        <div class="title">Змейка</div>
        <div class="score-box">
          <div class="score-pill">Счёт: <span id="score">0</span></div>
          <div class="best-pill">Рекорд: <span id="best">0</span></div>
        </div>
      </div>

      <div class="canvas-wrap">
        <canvas id="game" width="320" height="320"></canvas>
      </div>

      <div class="controls">
        <button class="btn-dir btn-up" data-dir="up">▲</button>
        <button class="btn-dir btn-left" data-dir="left">◀</button>
        <button class="btn-dir btn-down" data-dir="down">▼</button>
        <button class="btn-dir btn-right" data-dir="right">▶</button>
      </div>

      <div class="hint">
        Нажми любую стрелку, чтобы начать.  
        На ПК работают также клавиши-стрелки.
        <span id="statusBadge" class="badge-status">Готово</span>
      </div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");
    const bestEl = document.getElementById("best");
    const statusBadge = document.getElementById("statusBadge");

    const tileCount = 20;
    let tileSize = canvas.width / tileCount;

    let snake;
    let direction;
    let nextDirection;
    let food;
    let score = 0;
    let best = parseInt(localStorage.getItem("snakeBest") || "0", 10);
    bestEl.textContent = best;

    let gameInterval = null;
    const baseSpeed = 130; // мс между ходами
    let isGameOver = false;
    let isStarted = false;

    function resizeCanvas() {
      const maxSize = Math.min(window.innerWidth - 32, 420);
      const size = Math.max(220, maxSize);
      canvas.width = size;
      canvas.height = size;
      tileSize = canvas.width / tileCount;
      draw();
    }

    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    function initGame() {
      snake = [{ x: 10, y: 10 }];
      direction = { x: 1, y: 0 };
      nextDirection = { x: 1, y: 0 };
      score = 0;
      scoreEl.textContent = score;
      placeFood();
      isGameOver = false;
      isStarted = false;
      setStatus("Готово", "");
      stopLoop();
      draw();
    }

    function setStatus(text, mode) {
      statusBadge.textContent = text;
      statusBadge.classList.remove("paused", "over");
      if (mode === "paused") statusBadge.classList.add("paused");
      if (mode === "over") statusBadge.classList.add("over");
    }

    function placeFood() {
      while (true) {
        const x = Math.floor(Math.random() * tileCount);
        const y = Math.floor(Math.random() * tileCount);
        const onSnake = snake.some(seg => seg.x === x && seg.y === y);
        if (!onSnake) {
          food = { x, y };
          break;
        }
      }
    }

    function startLoop() {
      if (gameInterval) return;
      gameInterval = setInterval(gameStep, baseSpeed);
    }

    function stopLoop() {
      if (gameInterval) {
        clearInterval(gameInterval);
        gameInterval = null;
      }
    }

    function gameStep() {
      if (isGameOver) return;

      direction = nextDirection;

      const head = snake[0];
      const newHead = {
        x: head.x + direction.x,
        y: head.y + direction.y,
      };

      // Столкновение со стеной
      if (
        newHead.x < 0 ||
        newHead.x >= tileCount ||
        newHead.y < 0 ||
        newHead.y >= tileCount
      ) {
        gameOver();
        return;
      }

      // Столкновение с собой
      if (snake.some(seg => seg.x === newHead.x && seg.y === newHead.y)) {
        gameOver();
        return;
      }

      snake.unshift(newHead);

      // Еда
      if (newHead.x === food.x && newHead.y === food.y) {
        score++;
        scoreEl.textContent = score;
        if (score > best) {
          best = score;
          bestEl.textContent = best;
          localStorage.setItem("snakeBest", String(best));
        }
        placeFood();
      } else {
        snake.pop();
      }

      draw();
    }

    function gameOver() {
      isGameOver = true;
      stopLoop();
      setStatus("Игра окончена", "over");
    }

    function drawCell(x, y, color, radius = 6) {
      const px = x * tileSize;
      const py = y * tileSize;
      const r = Math.min(radius, tileSize / 2);

      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.moveTo(px + r, py);
      ctx.lineTo(px + tileSize - r, py);
      ctx.quadraticCurveTo(px + tileSize, py, px + tileSize, py + r);
      ctx.lineTo(px + tileSize, py + tileSize - r);
      ctx.quadraticCurveTo(px + tileSize, py + tileSize, px + tileSize - r, py + tileSize);
      ctx.lineTo(px + r, py + tileSize);
      ctx.quadraticCurveTo(px, py + tileSize, px, py + tileSize - r);
      ctx.lineTo(px, py + r);
      ctx.quadraticCurveTo(px, py, px + r, py);
      ctx.fill();
    }

    function draw() {
      // фон
      const grd = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
      grd.addColorStop(0, "#020617");
      grd.addColorStop(1, "#030712");
      ctx.fillStyle = grd;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // лёгкая сетка
      ctx.strokeStyle = "rgba(30,64,175,0.2)";
      ctx.lineWidth = 1;
      for (let i = 1; i < tileCount; i++) {
        const p = Math.round(i * tileSize) + 0.5;
        ctx.beginPath();
        ctx.moveTo(p, 0);
        ctx.lineTo(p, canvas.height);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(0, p);
        ctx.lineTo(canvas.width, p);
        ctx.stroke();
      }

      // еда
      drawCell(food.x, food.y, "#f97316", tileSize * 0.35);

      // змейка
      snake.forEach((seg, index) => {
        const t = index / Math.max(snake.length - 1, 1);
        const col = index === 0
          ? "#22c55e"
          : `rgba(34,197,94,${0.9 - t * 0.6})`;
        drawCell(seg.x, seg.y, col, index === 0 ? tileSize * 0.45 : tileSize * 0.35);
      });
    }

    function changeDirection(dir) {
      if (isGameOver) {
        initGame();
      }

      if (!isStarted) {
        isStarted = true;
        setStatus("Игра идёт", "");
        startLoop();
      }

      let newDir;
      if (dir === "up") newDir = { x: 0, y: -1 };
      if (dir === "down") newDir = { x: 0, y: 1 };
      if (dir === "left") newDir = { x: -1, y: 0 };
      if (dir === "right") newDir = { x: 1, y: 0 };

      // нельзя сразу развернуться на 180°
      if (
        newDir &&
        !(newDir.x === -direction.x && newDir.y === -direction.y)
      ) {
        nextDirection = newDir;
      }
    }

    // Кнопки управления
    document.querySelectorAll(".btn-dir").forEach(btn => {
      btn.addEventListener("click", () => {
        const dir = btn.getAttribute("data-dir");
        changeDirection(dir);
        if (window.navigator.vibrate) {
          window.navigator.vibrate(25);
        }
      });
    });

    // Клавиатура
    window.addEventListener("keydown", (e) => {
      if (e.key === "ArrowUp" || e.key === "w") changeDirection("up");
      if (e.key === "ArrowDown" || e.key === "s") changeDirection("down");
      if (e.key === "ArrowLeft" || e.key === "a") changeDirection("left");
      if (e.key === "ArrowRight" || e.key === "d") changeDirection("right");
      if (e.key === " ") {
        // пауза/продолжить
        if (isGameOver) {
          initGame();
        } else {
          if (gameInterval) {
            stopLoop();
            setStatus("Пауза", "paused");
          } else {
            if (!isStarted) isStarted = true;
            setStatus("Игра идёт", "");
            startLoop();
          }
        }
      }
    });

    initGame();
  </script>
</body>
</html>
